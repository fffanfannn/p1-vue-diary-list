<template>
  <header>
    <div class="container">
      <div class="flexbox">
        <div class="logo">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 2050 2050"
            data-name="Layer 2"
            id="Layer_2"
          >
            <title />
            <rect
              class="cls-1"
              height="1647.4"
              rx="88.2"
              ry="88.2"
              width="1212.7"
              x="640"
              y="209.3"
            />
            <path
              class="cls-2"
              d="M1826,1773.5H789.8a88.2,88.2,0,0,1-88.2-88.2V213.4A88.3,88.3,0,0,0,640,297.5V1768.4a88.3,88.3,0,0,0,88.3,88.3H1764.5a88.2,88.2,0,0,0,88.2-87.3A87.2,87.2,0,0,1,1826,1773.5Z"
            />
            <path
              class="cls-3"
              d="M880.2,209.3H728.3A88.2,88.2,0,0,0,640,297.5V1768.4a88.3,88.3,0,0,0,88.3,88.3H880.2Z"
            />
            <path
              class="cls-4"
              d="M789.8,1773.5a88.2,88.2,0,0,1-88.2-88.2V213.4A88.3,88.3,0,0,0,640,297.5V1768.4a88.3,88.3,0,0,0,88.3,88.3H880.2v-83.2Z"
            />
            <path
              class="cls-5"
              d="M757.1,572.9H591.7a59.5,59.5,0,0,1,0-119H757.1a59.5,59.5,0,0,1,0,119Z"
            />
            <path
              class="cls-5"
              d="M757.1,919.3H591.7a59.5,59.5,0,0,1,0-119H757.1a59.5,59.5,0,1,1,0,119Z"
            />
            <path
              class="cls-5"
              d="M757.1,1265.7H591.7a59.5,59.5,0,0,1,0-119H757.1a59.5,59.5,0,1,1,0,119Z"
            />
            <path
              class="cls-5"
              d="M757.1,1612.1H591.7a59.5,59.5,0,0,1,0-119H757.1a59.5,59.5,0,0,1,0,119Z"
            />
            <path
              class="cls-6"
              d="M805.3,534H639.9a59.6,59.6,0,0,1-59.5-59.5,58.2,58.2,0,0,1,3.5-20.1,59.5,59.5,0,0,0,7.8,118.5H757.1a59.5,59.5,0,0,0,56-39.5A50.3,50.3,0,0,1,805.3,534Z"
            />
            <path
              class="cls-6"
              d="M805.3,880.4H639.9a59.6,59.6,0,0,1-59.5-59.5,58.2,58.2,0,0,1,3.5-20.1,59.5,59.5,0,0,0,7.8,118.5H757.1a59.5,59.5,0,0,0,56-39.5A50.3,50.3,0,0,1,805.3,880.4Z"
            />
            <path
              class="cls-6"
              d="M805.3,1226.8H639.9a59.6,59.6,0,0,1-59.5-59.5,58.6,58.6,0,0,1,3.5-20.1,59.5,59.5,0,0,0,7.8,118.5H757.1a59.6,59.6,0,0,0,56-39.4A66.6,66.6,0,0,1,805.3,1226.8Z"
            />
            <path
              class="cls-6"
              d="M805.3,1573.2H639.9a59.6,59.6,0,0,1-59.5-59.5,58.6,58.6,0,0,1,3.5-20.1,59.5,59.5,0,0,0,7.8,118.5H757.1a59.6,59.6,0,0,0,56-39.4A66.6,66.6,0,0,1,805.3,1573.2Z"
            />
            <path
              class="cls-5"
              d="M1615.4,464.6H1035.3a20,20,0,0,1,0-40h580.1a20,20,0,0,1,0,40Z"
            />
            <path
              class="cls-5"
              d="M1487.6,629.7H1035.3a20,20,0,0,1,0-40h452.3a20,20,0,0,1,0,40Z"
            />
            <polygon
              class="cls-3"
              points="197.3 442.9 197.3 1591.6 417.6 1591.6 417.6 452.1 197.3 452.1 197.3 442.9"
            />
            <path
              class="cls-7"
              d="M417.6,303.5A110.2,110.2,0,0,0,307.4,193.3h0A110.1,110.1,0,0,0,197.3,303.5v63.6H417.6Z"
            />
            <rect class="cls-8" height="84.93" x="417.6" y="367.1" />
            <polygon
              class="cls-8"
              points="197.3 442.9 197.3 367.1 197.3 367.1 197.3 442.9"
            />
            <polygon
              class="cls-1"
              points="197.3 452.1 417.6 452.1 417.6 367.1 197.3 367.1 197.3 442.9 197.3 452.1"
            />
            <path
              class="cls-9"
              d="M197.3,1591.6H417.6l-89.1,201.9c-8.1,18.3-34.1,18.3-42.2,0Z"
            />
            <polygon
              class="cls-4"
              points="197.3 1591.6 255.3 1591.6 255.3 452.1 197.3 452.1 197.3 442.9 197.3 1591.6"
            />
            <path
              class="cls-10"
              d="M417.6,367.1H255.3V303.5a110.2,110.2,0,0,1,81.1-106.3,110.3,110.3,0,0,0-29-3.9h0A110.1,110.1,0,0,0,197.3,303.5v63.6Z"
            />
            <polygon
              class="cls-2"
              points="255.3 452.1 255.3 442.9 255.3 367.1 197.3 367.1 197.3 442.9 197.3 452.1 255.3 452.1"
            />
            <path
              class="cls-11"
              d="M328.5,1793.5l7.9-18-81.1-183.9h-58l89,201.9C294.4,1811.8,320.4,1811.8,328.5,1793.5Z"
            />
            <path
              class="cls-5"
              d="M293.3,723.5a19.9,19.9,0,0,1,34.1,14.1v691.2a20,20,0,0,1-40,0V737.6A20,20,0,0,1,293.3,723.5Z"
            />
            <path
              class="cls-5"
              d="M293.3,565.7a20,20,0,0,1,34.1,14.2v74.6a20,20,0,0,1-40,0V579.9A20.4,20.4,0,0,1,293.3,565.7Z"
            />
            <rect
              class="cls-12"
              height="278.37"
              rx="24.6"
              ry="24.6"
              transform="translate(785.4 2311.6) rotate(-180)"
              width="49.1"
              x="368.1"
              y="1016.6"
            />
            <rect
              class="cls-12"
              height="106.15"
              rx="24.6"
              ry="24.6"
              transform="translate(785.4 1822.4) rotate(-180)"
              width="49.1"
              x="368.1"
              y="858.1"
            />
            <rect
              class="cls-13"
              height="61.1"
              rx="24.6"
              ry="24.6"
              transform="translate(785.4 826.1) rotate(-180)"
              width="49.1"
              x="368.1"
              y="382.5"
            />
            <rect
              class="cls-14"
              height="107.2"
              rx="24.6"
              ry="24.6"
              transform="translate(779.4 628.4) rotate(-180)"
              width="49.1"
              x="365.1"
              y="260.6"
            />
            <rect
              class="cls-12"
              height="682.74"
              rx="19.8"
              ry="19.8"
              width="39.6"
              x="840.6"
              y="600.3"
            />
            <rect
              class="cls-15"
              height="45.42"
              rx="22.7"
              ry="22.7"
              width="136.4"
              x="644.2"
              y="453.9"
            />
            <rect
              class="cls-15"
              height="45.42"
              rx="22.7"
              ry="22.7"
              width="136.4"
              x="644.2"
              y="800.3"
            />
            <rect
              class="cls-15"
              height="45.42"
              rx="22.7"
              ry="22.7"
              width="136.4"
              x="644.2"
              y="1146.7"
            />
            <rect
              class="cls-15"
              height="45.42"
              rx="22.7"
              ry="22.7"
              width="136.4"
              x="644.2"
              y="1493.1"
            />
            <rect
              class="cls-13"
              height="952.93"
              rx="32.8"
              ry="32.8"
              width="65.5"
              x="1787.2"
              y="600.3"
            />
            <rect
              class="cls-13"
              height="47.93"
              rx="24"
              ry="24"
              width="400.8"
              x="1320.6"
              y="209.3"
            />
          </svg>
          <h1>MY DIARY</h1>
        </div>
        <ul>
          <li>
            <button
              @click="sortByInputDisplay"
              :class="{ isSortByInputDisplay: isSortByInputDisplay }"
              date-testid="create-button"
            >
              Create
            </button>
          </li>
          <li class="middleBtn">
            <button
              @click="sortBySearchDisplay"
              :class="{ isSortBySearchDisplay: isSortBySearchDisplay }"
              date-testid="search-button"
            >
              Search
            </button>
          </li>

          <li>
            <button
              @click="sortByDateDisplay"
              :class="{ isSortByDateDisplay: isSortByDateDisplay }"
              date-testid="sort-button"
            >
              Sort
            </button>
          </li>
        </ul>
      </div>
    </div>
  </header>

  <section class="searchDisplay" v-if="isSortBySearchDisplay">
    <div class="container">
      <input
        type="text"
        v-model="searchText"
        @input="searchBtn"
        placeholder="search by title"
      />
      <button @click="searchBtn" date-testid="search-btn">Search</button>
      <div class="flexbox">
        <DiaryItem
          v-for="diaryObj in searchArray"
          :key="diaryObj.id"
          :eachDiaryObj="diaryObj"
          @deleteObjId="deleteObjId"
        />
      </div>
    </div>
  </section>

  <section class="dateDisplay" v-if="isSortByDateDisplay">
    <div class="container">
      <button @click="sortByDate" class="sort-btn">Sort by date</button>
      <div v-if="isSortedByDate" class="flexbox">
        <DiaryItem
          v-for="diaryObj in displayedDiaryArray"
          :key="diaryObj.id"
          :eachDiaryObj="diaryObj"
          @deleteObjId="deleteObjId"
        />
      </div>
    </div>
  </section>

  <section class="inputDisplay" v-if="isSortByInputDisplay">
    <div class="container">
      <div class="flexbox">
        <DiaryItem
          v-for="diaryObj in diaryArray"
          :key="diaryObj.id"
          :eachDiaryObj="diaryObj"
          @deleteObjId="deleteObjId"
        />
      </div>
      <div class="pageBtn">
        <h3>Total: {{ diaryNum }}</h3>
      </div>
    </div>
  </section>
</template>

<script>
import DiaryItem from "@/components/DiaryItem.vue";
export default {
  name: "DiaryList",
  components: {
    DiaryItem,
  },

  props: ["diaryArray"],

  data() {
    return {
      isSortedByDate: false,
      searchArray: [],
      isSortByInputDisplay: true,
      isSortBySearchDisplay: false,
      isSortByDateDisplay: false,
    };
  },
  methods: {
    deleteObjId(id) {
      this.$emit("deleteObjId", id);
    },

    sortBySearchDisplay() {
      this.isSortBySearchDisplay = !this.isSortBySearchDisplay;
      this.isSortByInputDisplay = false;
    },

    sortByInputDisplay() {
      this.isSortByInputDisplay = true;
      this.isSortBySearchDisplay = false;
      this.isSortByDateDisplay = false;
    },

    sortByDateDisplay() {
      this.isSortByDateDisplay = !this.isSortByDateDisplay;
      this.isSortByInputDisplay = false;
    },

    sortByDate() {
      this.isSortedByDate = !this.isSortedByDate;
    },

    // searchBtn() {
    //   for (let diaryObj of this.diaryArray) {
    //     if (this.searchText === diaryObj.diaryTitle) {
    //       this.searchArray = [];
    //       this.searchArray.push(diaryObj);
    //     }
    //   }
    // },

    searchBtn() {
      this.searchArray = [];
      console.log("1");

      for (let diaryObj of this.diaryArray) {
        let searchRegExp = new RegExp(this.searchText, "gi"); // 'gi' flags for global and case-insensitive matching
        console.log("2");
        if (searchRegExp.test(diaryObj.diaryTitle)) {
          console.log("diaryObj:", diaryObj);
          this.searchArray.push(diaryObj);
          console.log("3");
        }
        console.log("4");
      }
      console.log("5");

      console.log("search array:", this.searchArray);
    },
  },

  computed: {
    diaryNum() {
      const diarynum = this.diaryArray.length;
      return diarynum;
    },

    pageCount() {
      const pagecount = Math.ceil(this.diaryArray.length / 3);
      return pagecount;
    },

    displayedDiaryArray() {
      const copyArray = [...this.diaryArray]; // Create a copy of the prop
      if (this.isSortedByDate) {
        return copyArray.sort(
          (a, b) => new Date(b.diaryDate) - new Date(a.diaryDate)
        );
      }
      return copyArray;
    },
  },
};
</script>

<style scoped lang="scss"></style>
